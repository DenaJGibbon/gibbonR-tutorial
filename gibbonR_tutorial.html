<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>gibbonR: An R package for the automated detection and classification of female gibbon calls from long-term acoustic recordings</title>

    <meta name="author" content="Dena J. Clink" />
  
   
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="gibbonR: An R package for the automated detection and classification of female gibbon calls from long-term acoustic recordings" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="gibbonR: An R package for the automated detection and classification of female gibbon calls from long-term acoustic recordings" />
  
  
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.3.1/transition.js"></script>
    <script src="libs/bs3compat-0.3.1/tabs.js"></script>
    <script src="libs/bs3compat-0.3.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
    
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<!--bookdown:title:start-->
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">gibbonR: An R package for the automated detection and classification of female gibbon calls from long-term acoustic recordings</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="getting-started" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Getting started</h1>
<div id="you-can-install-the-development-version-from-github-with" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> You can install the development version from <a href="https://github.com/DenaJGibbon">GitHub</a> with:</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;devtools&quot;)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github(&quot;DenaJGibbon/gibbonR&quot;)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gibbonR)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: stringr</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: e1071</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: randomForest</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; randomForest 4.7-1</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Type rfNews() to see new features/changes/bug fixes.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: tuneR</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: seewave</span></span></code></pre></div>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="part-1.-prepare-training-data" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Part 1. Prepare Training Data</h1>
<p>In ‘gibbonR’ there are two ways that you can format your training data. The first can be a set of labelled .wav clips with the class indicated in the name of the file (e.g., ‘gibbon_01.wav’ and ‘noise_01.wav’). The second is to have a folder of selection tables created in Raven Pro (K. Lisa Yang Center for Conservation Bioacoustics) and a folder with the associated ‘.wav’ files. For the second approach there must be an annotation column indicating the call type and it is assumed that all signals of interest are annotated, and the rest of the files contain only background noise.</p>
<div id="part-1a.-training-data-with-labeled-.wav-clips" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Part 1A. Training Data with Labeled .wav clips</h2>
<div id="read-in-clips-and-calculate-mfccs" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Read in clips and calculate MFCCs</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>TrainingWavFilesDir <span class="ot">&lt;-</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;/Users/denaclink/Desktop/RStudio Projects/gibbonR/data/MultipleSoundClasses/&quot;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>trainingdata <span class="ot">&lt;-</span> gibbonR<span class="sc">::</span><span class="fu">MFCCFunction</span>(<span class="at">input.dir=</span>TrainingWavFilesDir, <span class="at">min.freq =</span> <span class="dv">400</span>, <span class="at">max.freq =</span> <span class="dv">1600</span>,<span class="at">win.avg=</span><span class="st">&quot;TRUE&quot;</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>trainingdata<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(trainingdata<span class="sc">$</span>class)</span></code></pre></div>
</div>
<div id="compare-random-forest-and-support-vector-machine-for-supervised-classification" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Compare Random Forest and Support Vector Machine for Supervised Classification</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>trainingdata<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(trainingdata<span class="sc">$</span>class)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>ml.model.svm <span class="ot">&lt;-</span> e1071<span class="sc">::</span><span class="fu">svm</span>(trainingdata[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(trainingdata)], trainingdata<span class="sc">$</span>class, <span class="at">kernel =</span> <span class="st">&quot;radial&quot;</span>, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">cross =</span> <span class="dv">25</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&#39;SVM accuracy&#39;</span>,ml.model.svm<span class="sc">$</span>tot.accuracy))</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;SVM accuracy 88&quot;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>ml.model.rf <span class="ot">&lt;-</span> randomForest<span class="sc">::</span><span class="fu">randomForest</span>(<span class="at">x=</span>trainingdata[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(trainingdata)], <span class="at">y =</span> trainingdata<span class="sc">$</span>class)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ml.model.rf)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  randomForest(x = trainingdata[, 2:ncol(trainingdata)], y = trainingdata$class) </span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                Type of random forest: classification</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      Number of trees: 500</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; No. of variables tried at each split: 13</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         OOB estimate of  error rate: 13.33%</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Confusion matrix:</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               female.gibbon leaf.monkey noise solo.gibbon class.error</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; female.gibbon            17           0     2           1   0.1500000</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; leaf.monkey               0          11     4           0   0.2666667</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; noise                     0           0    18           2   0.1000000</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; solo.gibbon               0           1     0          19   0.0500000</span></span></code></pre></div>
</div>
</div>
<div id="part-1b.-training-data-with-raven-selection-tables" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Part 1B. Training Data with Raven Selection Tables</h2>
<div id="prepare-training-data-from-labeled-annotations" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Prepare training data from labeled annotations</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the folder where the training data will be saved</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>TrainingDataFolderLocation <span class="ot">&lt;-</span> <span class="st">&quot;/Users/denaclink/Desktop/RStudio Projects/gibbonR/data/TrainingDataFromRavenSelectionTables&quot;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Directory with annotated selection tables</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>AnnotatedSelectionTables <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;/Users/denaclink/Desktop/RStudio Projects/gibbonR/data/SelectionTables/GibbonTrainingSelectionTables/&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">full.names =</span> T)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Directory with corresponding .wav files</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>AnnotatedWaveFiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;/Users/denaclink/Library/CloudStorage/Box-Box/gibbonRSampleFiles/GibbonTrainingFiles/&quot;</span>,<span class="at">full.names =</span> T)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>AnnotatedWaveFilesShort <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;/Users/denaclink/Library/CloudStorage/Box-Box/gibbonRSampleFiles/GibbonTrainingFiles/&quot;</span>,<span class="at">full.names =</span> F)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>AnnotatedWaveFilesShort <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(AnnotatedWaveFilesShort,<span class="at">pattern =</span> <span class="st">&#39;.wav&#39;</span>, <span class="at">n=</span><span class="dv">2</span>)[,<span class="dv">1</span>]</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop to cut out the corresponding annotations into short clips</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span> <span class="fu">length</span>(AnnotatedSelectionTables)){</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read in selection table</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  TempSelectionTable <span class="ot">&lt;-</span> <span class="fu">read.delim2</span>(AnnotatedSelectionTables[i])</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the corresponding soundfile</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  SoundFileIndex <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">str_detect</span>(AnnotatedSelectionTables[i],AnnotatedWaveFilesShort))</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  TempAnnotateWave <span class="ot">&lt;-</span> <span class="fu">readWave</span>(AnnotatedWaveFiles[SoundFileIndex])</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  ShortSoundClips <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(TempSelectionTable),</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">function</span>(j) <span class="fu">extractWave</span>(TempAnnotateWave,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                                                        <span class="at">from=</span> <span class="fu">as.numeric</span>(TempSelectionTable[j,]<span class="sc">$</span>Begin.Time..s.),</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                                                        <span class="at">to=</span><span class="fu">as.numeric</span>(TempSelectionTable[j,]<span class="sc">$</span> End.Time..s.),</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                                                        <span class="at">xunit =</span> <span class="fu">c</span>(<span class="st">&quot;time&quot;</span>),<span class="at">plot=</span>F,<span class="at">output=</span><span class="st">&quot;Wave&quot;</span>))</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Write wave files to folder</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ShortSoundClips)){</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    TempClip <span class="ot">&lt;-</span> ShortSoundClips[[k]]</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    WavFileName <span class="ot">&lt;-</span> <span class="fu">paste</span>(TrainingDataFolderLocation,<span class="st">&#39;/female.gibbon_&#39;</span>, k, <span class="st">&#39;.wav&#39;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeWave</span>(TempClip,WavFileName,<span class="at">extensible =</span> F)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="prepare-noise-training-data-from-files-without-target-signal" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Prepare noise training data from files without target signal</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the folder where the training data will be saved</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>TrainingDataFolderLocation <span class="ot">&lt;-</span> <span class="st">&quot;/Users/denaclink/Desktop/RStudio Projects/gibbonR/data/TrainingDataFromRavenSelectionTables/&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Directory with annotated selection tables</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>NoiseSelectionTables <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;/Users/denaclink/Desktop/RStudio Projects/gibbonR/data/SelectionTables/NoiseSelectionTables/&quot;</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">full.names =</span> T)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Directory with corresponding .wav files</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>NoiseWaveFiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;/Users/denaclink/Library/CloudStorage/Box-Box/gibbonRSampleFiles/NoiseFiles/&quot;</span>,<span class="at">full.names =</span> T)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>NoiseWaveFilesShort <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;/Users/denaclink/Library/CloudStorage/Box-Box/gibbonRSampleFiles/NoiseFiles/&quot;</span>,<span class="at">full.names =</span> F)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>NoiseWaveFilesShort <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(NoiseWaveFilesShort,<span class="at">pattern =</span> <span class="st">&#39;.wav&#39;</span>, <span class="at">n=</span><span class="dv">2</span>)[,<span class="dv">1</span>]</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(NoiseSelectionTables)){</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the corresponding soundfile</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  SoundFileIndex <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">str_detect</span>(NoiseSelectionTables[i],NoiseWaveFilesShort))</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">DetectBLED</span>(<span class="at">input=</span>NoiseWaveFiles[SoundFileIndex],</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">min.freq =</span> <span class="dv">400</span>, </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">max.freq =</span> <span class="dv">1600</span>,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">noise.quantile.val=</span><span class="fl">0.3</span>,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">file.type=</span><span class="st">&#39;wav&#39;</span>,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">spectrogram.window =</span><span class="dv">512</span>,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>           <span class="at">pattern.split =</span> <span class="st">&quot;.wav&quot;</span>, </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">min.signal.dur =</span> <span class="dv">3</span>,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>           <span class="at">max.sound.event.dur =</span> <span class="dv">12</span>, </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">output =</span> <span class="st">&quot;wav&quot;</span>,</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">wav.output =</span> <span class="st">&quot;TRUE&quot;</span>, </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">output.dir =</span> TrainingDataFolderLocation,</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">swift.time=</span><span class="cn">TRUE</span>,</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">time.start=</span><span class="dv">06</span>,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">time.stop=</span><span class="dv">11</span>,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">write.csv.output=</span><span class="cn">TRUE</span>,</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">verbose=</span><span class="cn">TRUE</span>,</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">random.sample=</span><span class="cn">FALSE</span>)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="now-read-in-clips-based-on-raven-selection-tables-and-calculate-mfccs" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Now read in clips based on Raven Selection tables and calculate MFCCs</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>TrainingWavFilesDir <span class="ot">&lt;-</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;/Users/denaclink/Desktop/RStudio Projects/gibbonR/data/TrainingDataFromRavenSelectionTables/&quot;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>trainingdata <span class="ot">&lt;-</span> gibbonR<span class="sc">::</span><span class="fu">MFCCFunction</span>(<span class="at">input.dir=</span>TrainingWavFilesDir, <span class="at">min.freq =</span> <span class="dv">400</span>, <span class="at">max.freq =</span> <span class="dv">1600</span>,<span class="at">win.avg=</span><span class="st">&quot;TRUE&quot;</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>trainingdata<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(trainingdata<span class="sc">$</span>class)</span></code></pre></div>
</div>
<div id="compare-random-forest-and-support-vector-machine-for-supervised-classification-1" class="section level3" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Compare Random Forest and Support Vector Machine for Supervised Classification</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>trainingdata<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(trainingdata<span class="sc">$</span>class)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>ml.model.svm <span class="ot">&lt;-</span> e1071<span class="sc">::</span><span class="fu">svm</span>(trainingdata[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(trainingdata)], trainingdata<span class="sc">$</span>class, <span class="at">kernel =</span> <span class="st">&quot;radial&quot;</span>, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">cross =</span> <span class="dv">25</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&#39;SVM accuracy&#39;</span>,ml.model.svm<span class="sc">$</span>tot.accuracy))</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;SVM accuracy 98.1132075471698&quot;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>ml.model.rf <span class="ot">&lt;-</span> randomForest<span class="sc">::</span><span class="fu">randomForest</span>(<span class="at">x=</span>trainingdata[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(trainingdata)], <span class="at">y =</span> trainingdata<span class="sc">$</span>class)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ml.model.rf)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  randomForest(x = trainingdata[, 2:ncol(trainingdata)], y = trainingdata$class) </span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                Type of random forest: classification</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      Number of trees: 500</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; No. of variables tried at each split: 13</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         OOB estimate of  error rate: 3.77%</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Confusion matrix:</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               female.gibbon noise class.error</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; female.gibbon            25     1  0.03846154</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; noise                     1    26  0.03703704</span></span></code></pre></div>
<!--chapter:end:01-Prepare-training-data.Rmd-->
</div>
</div>
</div>
<div id="part-2.-run-the-detectorclassifier" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Part 2. Run the detector/classifier</h1>
<div id="part-2a.-feature-extraction" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Part 2a. Feature extraction</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the folder where the training data will be saved</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>TrainingDataFolderLocation <span class="ot">&lt;-</span> <span class="st">&quot;/Users/denaclink/Desktop/RStudio Projects/gibbonR/data/TrainingDataFromRavenSelectionTables/&quot;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>TrainingDataMFCC <span class="ot">&lt;-</span> <span class="fu">MFCCFunction</span>(<span class="at">input.dir=</span> TrainingDataFolderLocation, <span class="at">min.freq =</span> <span class="dv">400</span>, <span class="at">max.freq =</span> <span class="dv">1600</span>,<span class="at">win.avg=</span><span class="st">&quot;TRUE&quot;</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  TrainingDataMFCC<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(TrainingDataMFCC<span class="sc">$</span>class)</span></code></pre></div>
</div>
<div id="part-2b.-run-detectclassify" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Part 2b. Run DetectClassify</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  TestFileDirectory <span class="ot">&lt;-</span> <span class="st">&#39;/Users/denaclink/Library/CloudStorage/Box-Box/gibbonRSampleFiles/GibbonTestFiles&#39;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  OutputDirectory <span class="ot">&lt;-</span>  <span class="st">&quot;/Users/denaclink/Desktop/RStudio Projects/gibbonR/data/DetectAndClassifyOutput&quot;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">DetectAndClassify</span>(<span class="at">input=</span>TestFileDirectory,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">input.type=</span><span class="st">&#39;directory&#39;</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">feature.df=</span>TrainingDataMFCC,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model.type.list=</span><span class="fu">c</span>(<span class="st">&#39;SVM&#39;</span>,<span class="st">&#39;RF&#39;</span>),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">tune =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">short.wav.duration=</span><span class="dv">300</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">target.signal =</span> <span class="fu">c</span>(<span class="st">&quot;female.gibbon&quot;</span>),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">min.freq =</span> <span class="dv">400</span>, <span class="at">max.freq =</span> <span class="dv">1600</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">noise.quantile.val=</span><span class="fl">0.15</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">time.window.number =</span><span class="dv">3</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">n.windows =</span> <span class="dv">9</span>, <span class="at">num.cep =</span> <span class="dv">12</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">spectrogram.window =</span><span class="dv">160</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pattern.split =</span> <span class="st">&quot;.wav&quot;</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">min.signal.dur =</span> <span class="dv">3</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">max.sound.event.dur =</span> <span class="dv">25</span>,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>                    <span class="at">maximum.separation =</span><span class="dv">1</span>,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>                    <span class="at">probability.thresh.svm =</span> <span class="fl">0.15</span>,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                    <span class="at">probability.thresh.rf =</span> <span class="fl">0.15</span>,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                    <span class="at">wav.output =</span> <span class="st">&quot;TRUE&quot;</span>,</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">output.dir =</span>OutputDirectory,</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">swift.time=</span><span class="cn">TRUE</span>,<span class="at">time.start=</span><span class="dv">5</span>,<span class="at">time.stop=</span><span class="dv">10</span>,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                    <span class="at">write.csv.output=</span><span class="cn">FALSE</span>,<span class="at">verbose=</span><span class="cn">TRUE</span>,</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">random.sample=</span><span class="st">&#39;NA&#39;</span>)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Machine learning in progress...&quot;</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;SVM in progress...&quot;</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;SVM accuracy 98.1132075471698&quot;</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Time difference of 1.661945 secs</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;RF in progress...&quot;</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  randomForest(x = feature.df[, 2:ncol(feature.df)], y = feature.df$class) </span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                Type of random forest: classification</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      Number of trees: 500</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; No. of variables tried at each split: 13</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         OOB estimate of  error rate: 5.66%</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Confusion matrix:</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               female.gibbon noise class.error</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; female.gibbon            25     1  0.03846154</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; noise                     2    25  0.07407407</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Time difference of 0.06267691 secs</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Classifying for target signal female.gibbon&quot;</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Computing spectrogram for file S11_20180217_080003 1 out of 1&quot;</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Running detector over sound files&quot;</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Creating datasheet&quot;</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;System processed 7201 seconds in 15 seconds this translates to 492 hours processed in 1 hour&quot;</span></span></code></pre></div>
<!--chapter:end:02-Run-the-detector-classifier.Rmd-->
</div>
</div>
<div id="part-3.-calculate-performance-metrics" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Part 3. Calculate performance metrics</h1>
<div id="part-3a.-prepare-data-for-performance-metrics" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Part 3a. Prepare data for performance metrics</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set location of test file selection tables</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>input.dir.text.files <span class="ot">&lt;-</span> <span class="st">&quot;/Users/denaclink/Desktop/RStudio Projects/gibbonR/data/SelectionTables/GibbonTestSelectionTables&quot;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>Annotatedfiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(input.dir.text.files,<span class="at">full.names =</span> T)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>ListOfAnnotatedFilesShort <span class="ot">&lt;-</span> <span class="fu">list.files</span>(input.dir.text.files,<span class="at">full.names =</span> F)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>nslash <span class="ot">&lt;-</span> <span class="fu">str_count</span>(Annotatedfiles,<span class="at">pattern =</span> <span class="st">&#39;/&#39;</span>)[<span class="dv">1</span>]<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>snames <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(Annotatedfiles,<span class="at">pattern =</span> <span class="st">&#39;/&#39;</span>,<span class="at">n=</span>nslash)[,nslash]</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>all.detections <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(Annotatedfiles)){</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  temp.table <span class="ot">&lt;-</span> <span class="fu">read.delim2</span>(Annotatedfiles[x],<span class="at">fill =</span> T,<span class="at">header =</span>T)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  file.name <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(snames[x],<span class="at">pattern =</span> <span class="st">&#39;[.]&#39;</span>,<span class="at">n=</span><span class="dv">2</span>)[,<span class="dv">1</span>]</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  recorder <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(file.name,<span class="at">pattern=</span><span class="st">&#39;_&#39;</span>,<span class="at">n=</span><span class="dv">3</span>)[,<span class="dv">1</span>]</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  date <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(file.name,<span class="at">pattern=</span><span class="st">&#39;_&#39;</span>,<span class="at">n=</span><span class="dv">3</span>)[,<span class="dv">2</span>]</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(file.name,<span class="at">pattern=</span><span class="st">&#39;_&#39;</span>,<span class="at">n=</span><span class="dv">3</span>)[,<span class="dv">3</span>]</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(temp.table <span class="sc">&gt;</span><span class="dv">0</span>)){</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    temp.table.updated <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(file.name,recorder,date,time,temp.table)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    temp.row <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">rep</span>(<span class="st">&#39;NA&#39;</span>,<span class="fu">ncol</span>(temp.table))))</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(temp.row) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(temp.table)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    temp.table.updated <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(file.name,recorder,date,time,temp.row)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  all.detections <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(all.detections,temp.table.updated)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="part-3b.-identify-true-and-false-positives" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Part 3b. Identify true and false positives</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>  OutputDirectory <span class="ot">&lt;-</span>  <span class="st">&quot;/Users/denaclink/Desktop/RStudio Projects/gibbonR/data/DetectAndClassifyOutput&quot;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  all.combinedprecision.recall.randomiter <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  range.secs.start <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  range.secs.end <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Detections using band-limited energy summation</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  gibbondetects <span class="ot">&lt;-</span> OutputDirectory</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  list.ml <span class="ot">&lt;-</span>  <span class="fu">list.files</span>(gibbondetects, <span class="at">full.names =</span> T, <span class="at">pattern=</span><span class="st">&#39;.wav&#39;</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Need to focus on gibbons for this validation</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  nslash <span class="ot">&lt;-</span> <span class="fu">str_count</span>(list.ml[[<span class="dv">1</span>]],<span class="st">&#39;/&#39;</span>)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  list.ml.signals <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(list.ml,<span class="at">pattern =</span> <span class="st">&#39;/&#39;</span>,<span class="at">n=</span>nslash)[,nslash]</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  list.ml.signals <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(list.ml.signals,<span class="at">pattern =</span> <span class="st">&#39;_&#39;</span>,<span class="at">n=</span><span class="dv">5</span>)[,<span class="dv">4</span>]</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  list.ml <span class="ot">&lt;-</span> </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    list.ml[<span class="fu">which</span>(list.ml.signals<span class="sc">==</span><span class="st">&#39;female.gibbon&#39;</span>)]</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  ml.detection.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(list.ml)){</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    L.wav <span class="ot">&lt;-</span> list.ml[[y]]</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    n.slash  <span class="ot">&lt;-</span> <span class="fu">str_count</span>(L.wav, <span class="at">pattern =</span> <span class="st">&quot;/&quot;</span>)[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    det.file.name <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(L.wav,<span class="st">&quot;/&quot;</span>,<span class="at">n=</span>n.slash)[,n.slash]</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    det.file.name <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(det.file.name,<span class="st">&quot;.wav&quot;</span>,<span class="at">n=</span><span class="dv">2</span>)[,<span class="dv">1</span>]</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    file.name <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">str_split_fixed</span>(det.file.name,<span class="st">&quot;_&quot;</span>,<span class="at">n=</span><span class="dv">5</span>)[,<span class="dv">1</span>],<span class="fu">str_split_fixed</span>(det.file.name,<span class="st">&quot;_&quot;</span>,<span class="at">n=</span><span class="dv">5</span>)[,<span class="dv">2</span>],</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">str_split_fixed</span>(det.file.name,<span class="st">&quot;_&quot;</span>,<span class="at">n=</span><span class="dv">5</span>)[,<span class="dv">3</span>], <span class="at">sep=</span><span class="st">&#39;_&#39;</span>)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    det.date <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(det.file.name,<span class="st">&quot;_&quot;</span>,<span class="at">n=</span><span class="dv">5</span>)[,<span class="dv">2</span>]</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    det.time <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(det.file.name,<span class="st">&quot;_&quot;</span>,<span class="at">n=</span><span class="dv">5</span>)[,<span class="dv">3</span>]</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    det.swift <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(det.file.name,<span class="st">&quot;_&quot;</span>,<span class="at">n=</span><span class="dv">5</span>)[,<span class="dv">1</span>]</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    det.time.start <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_split_fixed</span>(det.file.name,<span class="st">&quot;_&quot;</span>,<span class="at">n=</span><span class="dv">9</span>)[,<span class="dv">6</span>])</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    det.time.end <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_split_fixed</span>(det.file.name,<span class="st">&quot;_&quot;</span>,<span class="at">n=</span><span class="dv">9</span>)[,<span class="dv">7</span>])</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    probability <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(det.file.name,<span class="st">&quot;_&quot;</span>,<span class="at">n=</span><span class="dv">8</span>)[,<span class="dv">8</span>]</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    ml.algorithm <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(det.file.name,<span class="st">&quot;_&quot;</span>,<span class="at">n=</span><span class="dv">7</span>)[,<span class="dv">5</span>]</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    detections.df <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(file.name,det.swift, det.date, det.time,det.time.start,det.time.end,probability,ml.algorithm)</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    ml.detection.df <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(ml.detection.df,detections.df)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  recall.snr.all.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ml.detection.df)){</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    all.detections.subset <span class="ot">&lt;-</span> ml.detection.df[x,]</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>    validate.detect.subset <span class="ot">&lt;-</span><span class="fu">subset</span>(all.detections,file.name<span class="sc">==</span><span class="fu">as.character</span>(all.detections.subset<span class="sc">$</span>file.name))</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>    validate.detect.subset<span class="sc">$</span>Begin.Time..s. <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(validate.detect.subset<span class="sc">$</span>Begin.Time..s.)</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>    min.start.time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(all.detections.subset<span class="sc">$</span>det.time.start)<span class="sc">-</span>range.secs.start</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>    max.start.time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(all.detections.subset<span class="sc">$</span>det.time.start)<span class="sc">+</span>range.secs.end</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>    detections.ml <span class="ot">&lt;-</span> <span class="fu">subset</span>(validate.detect.subset, Begin.Time..s.<span class="sc">&gt;</span>min.start.time <span class="sc">&amp;</span> Begin.Time..s.<span class="sc">&lt;</span> max.start.time)</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">nrow</span>(detections.ml)<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>      all.detections.subset<span class="sc">$</span>class.label <span class="ot">&lt;-</span> <span class="st">&#39;1&#39;</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>        all.detections.subset<span class="sc">$</span>class.label <span class="ot">&lt;-</span> <span class="st">&#39;-1&#39;</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    recall.snr.all.df <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(recall.snr.all.df,all.detections.subset)</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>  </span></code></pre></div>
</div>
<div id="part-3c.-calculate-and-plot-performance-metrics-using-rocr" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Part 3c. Calculate and plot performance metrics using ‘ROCR’</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>auc.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>performance.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  ml.index <span class="ot">&lt;-</span> <span class="fu">unique</span>(recall.snr.all.df<span class="sc">$</span>ml.algorithm)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ml.index)){</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    temp.subset <span class="ot">&lt;-</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(recall.snr.all.df,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>           ml.algorithm<span class="sc">==</span>ml.index[m])</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(temp.subset<span class="sc">$</span>probability)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  labels <span class="ot">&lt;-</span> (temp.subset<span class="sc">$</span>class.label)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(predictions, labels)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">&quot;rec&quot;</span>, <span class="st">&quot;prec&quot;</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  perfauc <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">&quot;aucpr&quot;</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  Precision <span class="ot">&lt;-</span> perf<span class="sc">@</span>x.values[[<span class="dv">1</span>]]</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  Recall <span class="ot">&lt;-</span> perf<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  Threshold <span class="ot">&lt;-</span> perf<span class="sc">@</span>alpha.values[[<span class="dv">1</span>]]</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  AUC <span class="ot">&lt;-</span> perfauc<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  perfF1 <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">&quot;f&quot;</span>)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  F1 <span class="ot">&lt;-</span>  perfF1<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(AUC)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  ml.algorithm <span class="ot">&lt;-</span> ml.index[m]</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  tempauc <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(AUC,ml.algorithm)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  auc.df <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(auc.df,tempauc)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  temp.performance <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(Precision,Recall,Threshold,F1,ml.algorithm)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  performance.df <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(performance.df,temp.performance)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">&quot;prec&quot;</span>, <span class="st">&quot;rec&quot;</span>)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(perf,</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>     <span class="at">avg=</span> <span class="st">&quot;threshold&quot;</span>,</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>     <span class="at">colorize=</span><span class="cn">TRUE</span>,</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd=</span> <span class="dv">3</span>,</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span> <span class="fu">paste</span>(ml.index[m],<span class="st">&#39;Precision/Recall&#39;</span>))</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf,</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>     <span class="at">lty=</span><span class="dv">3</span>,</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">&quot;grey78&quot;</span>,</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>     <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.5831775</span></span></code></pre></div>
<p><img src="gibbonR_tutorial_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<pre><code>#&gt; [1] 0.9388036</code></pre>
<p><img src="gibbonR_tutorial_files/figure-html/unnamed-chunk-13-2.png" width="672" /></p>
<!--chapter:end:03-Calculate-performance-metrics.Rmd-->
</div>
</div>
<div id="part-4.-data-visualization" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Part 4. Data visualization</h1>
<div id="part-4a.-create-a-umap-plot-colored-by-class" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Part 4a. Create a UMAP plot colored by class</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gibbonR)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: ggplot2</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;ggplot2&#39;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:randomForest&#39;:</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     margin</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">UMAPBiplotAddSpectrograms</span>(<span class="at">input.dir.Focal=</span><span class="st">&quot;/Users/denaclink/Desktop/RStudio Projects/gibbonR/data/MultipleSoundClasses/&quot;</span>,<span class="at">output.dir.Focal=</span><span class="st">&quot;/Users/denaclink/Desktop/RStudio Projects/gibbonR/data/MultipleSoundClasses/Thumbnails/&quot;</span>,<span class="at">add.spectrograms=</span><span class="cn">TRUE</span>,<span class="at">min.freq=</span><span class="dv">400</span>,<span class="at">max.freq=</span><span class="dv">1600</span>,<span class="at">main=</span><span class="st">&quot;UMAP Plot&quot;</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Step 1 Calculating MFCCs&quot;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Step 2 Creating biplot&quot;</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Step 3 Creating Spectrograms&quot;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;/Users/denaclink/Desktop/RStudio Projects/gibbonR/data/MultipleSoundClasses/Thumbnails/ already exists&quot;</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Step 4 Adding Spectrograms to Plot &quot;</span></span></code></pre></div>
<p><img src="gibbonR_tutorial_files/figure-html/unnamed-chunk-14-1.png" width="672" />
## Part 4b. Create a UMAP plot colored by affinity propagation clustering</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gibbonR)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(apcluster)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;apcluster&#39;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:stats&#39;:</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     heatmap</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">AffinityBiplotAddSpectrograms</span>(<span class="at">input.dir.Focal=</span><span class="st">&quot;/Users/denaclink/Desktop/RStudio Projects/gibbonR/data/MultipleSoundClasses/&quot;</span>,<span class="at">output.dir.Focal=</span><span class="st">&quot;/Users/denaclink/Desktop/RStudio Projects/gibbonR/data/MultipleSoundClasses/Thumbnails/&quot;</span>,<span class="at">class=</span><span class="st">&#39;fixed&#39;</span>, <span class="at">q.fixed=</span><span class="fl">0.1</span>,<span class="at">add.spectrograms=</span><span class="cn">TRUE</span>,<span class="at">min.freq=</span><span class="dv">400</span>,<span class="at">max.freq=</span><span class="dv">1600</span>,<span class="at">main=</span><span class="st">&quot;UMAP Plot&quot;</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Step 1 Calculating MFCCs&quot;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Step 2 Computing unsupervised clustering with fixed q&quot;</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Step 3 Creating Spectrograms &quot;</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;/Users/denaclink/Desktop/RStudio Projects/gibbonR/data/MultipleSoundClasses/Thumbnails/ already exists&quot;</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Adding Spectrograms to Plot Step 3 of 3&quot;</span></span></code></pre></div>
<p><img src="gibbonR_tutorial_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<!--chapter:end:04-Data-visualization.Rmd-->
</div>
</div>
<!--bookdown:body:end-->
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>gibbonR: An R package for the automated detection and classification of female gibbon calls from long-term acoustic recordings</strong>" was written by Dena J. Clink. It was last built on 2022-10-15.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


</body>

</html>
