<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Part 1. Prepare Training Data | gibbonR: An R package for the automated detection and classification of female gibbon calls from long-term acoustic recordings</title>
  <meta name="description" content="2 Part 1. Prepare Training Data | gibbonR: An R package for the automated detection and classification of female gibbon calls from long-term acoustic recordings" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Part 1. Prepare Training Data | gibbonR: An R package for the automated detection and classification of female gibbon calls from long-term acoustic recordings" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="DenaJGibbon/gibbonR-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Part 1. Prepare Training Data | gibbonR: An R package for the automated detection and classification of female gibbon calls from long-term acoustic recordings" />
  
  
  

<meta name="author" content="Dena J. Clink" />


<meta name="date" content="2024-06-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="part-2.-run-the-detectorclassifier.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"> gibbonR </a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> output:</a></li>
<li class="chapter" data-level="2" data-path="part-1.-prepare-training-data.html"><a href="part-1.-prepare-training-data.html"><i class="fa fa-check"></i><b>2</b> Part 1. Prepare Training Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="part-1.-prepare-training-data.html"><a href="part-1.-prepare-training-data.html#load-the-library"><i class="fa fa-check"></i><b>2.1</b> Load the library</a></li>
<li class="chapter" data-level="2.2" data-path="part-1.-prepare-training-data.html"><a href="part-1.-prepare-training-data.html#download-the-data-from-github"><i class="fa fa-check"></i><b>2.2</b> Download the data from Github</a></li>
<li class="chapter" data-level="2.3" data-path="part-1.-prepare-training-data.html"><a href="part-1.-prepare-training-data.html#part-1a.-training-data-with-labeled-.wav-clips"><i class="fa fa-check"></i><b>2.3</b> Part 1A. Training Data with Labeled .wav clips</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="part-1.-prepare-training-data.html"><a href="part-1.-prepare-training-data.html#read-in-clips-and-calculate-mfccs"><i class="fa fa-check"></i><b>2.3.1</b> Read in clips and calculate MFCCs</a></li>
<li class="chapter" data-level="2.3.2" data-path="part-1.-prepare-training-data.html"><a href="part-1.-prepare-training-data.html#compare-random-forest-and-support-vector-machine-for-supervised-classification"><i class="fa fa-check"></i><b>2.3.2</b> Compare Random Forest and Support Vector Machine for Supervised Classification</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="part-1.-prepare-training-data.html"><a href="part-1.-prepare-training-data.html#part-1b.-training-data-with-raven-selection-tables"><i class="fa fa-check"></i><b>2.4</b> Part 1B. Training Data with Raven Selection Tables</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="part-1.-prepare-training-data.html"><a href="part-1.-prepare-training-data.html#prepare-training-data-from-labeled-annotations"><i class="fa fa-check"></i><b>2.4.1</b> Prepare training data from labeled annotations</a></li>
<li class="chapter" data-level="2.4.2" data-path="part-1.-prepare-training-data.html"><a href="part-1.-prepare-training-data.html#prepare-noise-training-data-from-files-without-target-signal"><i class="fa fa-check"></i><b>2.4.2</b> Prepare noise training data from files without target signal</a></li>
<li class="chapter" data-level="2.4.3" data-path="part-1.-prepare-training-data.html"><a href="part-1.-prepare-training-data.html#now-read-in-clips-based-on-raven-selection-tables-and-calculate-mfccs"><i class="fa fa-check"></i><b>2.4.3</b> Now read in clips based on Raven Selection tables and calculate MFCCs</a></li>
<li class="chapter" data-level="2.4.4" data-path="part-1.-prepare-training-data.html"><a href="part-1.-prepare-training-data.html#compare-random-forest-and-support-vector-machine-for-supervised-classification-1"><i class="fa fa-check"></i><b>2.4.4</b> Compare Random Forest and Support Vector Machine for Supervised Classification</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="part-2.-run-the-detectorclassifier.html"><a href="part-2.-run-the-detectorclassifier.html"><i class="fa fa-check"></i><b>3</b> Part 2. Run the detector/classifier</a>
<ul>
<li class="chapter" data-level="3.1" data-path="part-2.-run-the-detectorclassifier.html"><a href="part-2.-run-the-detectorclassifier.html#part-2a.-feature-extraction"><i class="fa fa-check"></i><b>3.1</b> Part 2a. Feature extraction</a></li>
<li class="chapter" data-level="3.2" data-path="part-2.-run-the-detectorclassifier.html"><a href="part-2.-run-the-detectorclassifier.html#part-2b.-run-the-detectorclassifier-using-the-gibbonr-function."><i class="fa fa-check"></i><b>3.2</b> Part 2b. Run the detector/classifier using the ‘gibbonR’ function.</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="part-3.-calculate-performance-metrics.html"><a href="part-3.-calculate-performance-metrics.html"><i class="fa fa-check"></i><b>4</b> Part 3. Calculate performance metrics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="part-3.-calculate-performance-metrics.html"><a href="part-3.-calculate-performance-metrics.html#part-3a.-load-libraries-and-specify-file-paths"><i class="fa fa-check"></i><b>4.1</b> Part 3a. Load libraries and specify file paths</a></li>
<li class="chapter" data-level="4.2" data-path="part-3.-calculate-performance-metrics.html"><a href="part-3.-calculate-performance-metrics.html#part-3b.-match-detections-with-human-annotations"><i class="fa fa-check"></i><b>4.2</b> Part 3b. Match detections with human annotations</a></li>
<li class="chapter" data-level="4.3" data-path="part-3.-calculate-performance-metrics.html"><a href="part-3.-calculate-performance-metrics.html#part-3c.-calculate-performance-metrics"><i class="fa fa-check"></i><b>4.3</b> Part 3c. Calculate performance metrics</a></li>
<li class="chapter" data-level="4.4" data-path="part-3.-calculate-performance-metrics.html"><a href="part-3.-calculate-performance-metrics.html#d.-plot-the-results"><i class="fa fa-check"></i><b>4.4</b> 3d. Plot the results</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="part-4.-data-visualization.html"><a href="part-4.-data-visualization.html"><i class="fa fa-check"></i><b>5</b> Part 4. Data visualization</a>
<ul>
<li class="chapter" data-level="5.1" data-path="part-4.-data-visualization.html"><a href="part-4.-data-visualization.html#part-4a.-create-a-umap-plot-colored-by-class"><i class="fa fa-check"></i><b>5.1</b> Part 4a. Create a UMAP plot colored by class</a></li>
<li class="chapter" data-level="5.2" data-path="part-4.-data-visualization.html"><a href="part-4.-data-visualization.html#part-4b.-create-a-umap-plot-colored-by-affinity-propagation-clustering"><i class="fa fa-check"></i><b>5.2</b> Part 4b. Create a UMAP plot colored by affinity propagation clustering</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">gibbonR: An R package for the automated detection and classification of female gibbon calls from long-term acoustic recordings</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="part-1.-prepare-training-data" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Part 1. Prepare Training Data<a href="part-1.-prepare-training-data.html#part-1.-prepare-training-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In ‘gibbonR’ there are two ways that you can format your training data. The first can be a set of labelled .wav clips with the class indicated in the name of the file (e.g., ‘gibbon_01.wav’ and ‘noise_01.wav’). The second is to have a folder of selection tables created in Raven Pro (K. Lisa Yang Center for Conservation Bioacoustics) and a folder with the associated ‘.wav’ files. For the second approach there must be an annotation column indicating the call type and it is assumed that all signals of interest are annotated, and the rest of the files contain only background noise.</p>
<div id="load-the-library" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Load the library<a href="part-1.-prepare-training-data.html#load-the-library" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="part-1.-prepare-training-data.html#cb1-1" tabindex="-1"></a><span class="co"># Assume the package is already installed</span></span>
<span id="cb1-2"><a href="part-1.-prepare-training-data.html#cb1-2" tabindex="-1"></a><span class="fu">library</span>(gibbonR)</span>
<span id="cb1-3"><a href="part-1.-prepare-training-data.html#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="part-1.-prepare-training-data.html#cb1-4" tabindex="-1"></a><span class="co"># Set location of downloaded data</span></span>
<span id="cb1-5"><a href="part-1.-prepare-training-data.html#cb1-5" tabindex="-1"></a>FolderPath <span class="ot">&lt;-</span> <span class="st">&#39;/Users/denaclink/Library/CloudStorage/Box-Box/gibbonRSampleFiles/&#39;</span></span></code></pre></div>
</div>
<div id="download-the-data-from-github" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Download the data from Github<a href="part-1.-prepare-training-data.html#download-the-data-from-github" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="part-1.-prepare-training-data.html#cb2-1" tabindex="-1"></a><span class="co"># You need to tell R where to store the zip files on your computer.</span></span>
<span id="cb2-2"><a href="part-1.-prepare-training-data.html#cb2-2" tabindex="-1"></a>destination.file.path.zip <span class="ot">&lt;-</span></span>
<span id="cb2-3"><a href="part-1.-prepare-training-data.html#cb2-3" tabindex="-1"></a>  <span class="st">&quot;data/BorneoExampleData.zip&quot;</span></span>
<span id="cb2-4"><a href="part-1.-prepare-training-data.html#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="part-1.-prepare-training-data.html#cb2-5" tabindex="-1"></a><span class="co"># You also need to tell R where to save the unzipped files</span></span>
<span id="cb2-6"><a href="part-1.-prepare-training-data.html#cb2-6" tabindex="-1"></a>destination.file.path <span class="ot">&lt;-</span> <span class="st">&quot;data/&quot;</span></span>
<span id="cb2-7"><a href="part-1.-prepare-training-data.html#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="part-1.-prepare-training-data.html#cb2-8" tabindex="-1"></a><span class="co"># This function will download the data from github</span></span>
<span id="cb2-9"><a href="part-1.-prepare-training-data.html#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="part-1.-prepare-training-data.html#cb2-10" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">download.file</span>(<span class="st">&quot;https://github.com/DenaJGibbon/BorneoExampleData/archive/master.zip&quot;</span>,</span>
<span id="cb2-11"><a href="part-1.-prepare-training-data.html#cb2-11" tabindex="-1"></a>                     <span class="at">destfile =</span> destination.file.path.zip)</span>
<span id="cb2-12"><a href="part-1.-prepare-training-data.html#cb2-12" tabindex="-1"></a></span>
<span id="cb2-13"><a href="part-1.-prepare-training-data.html#cb2-13" tabindex="-1"></a><span class="co"># This function will unzip the file</span></span>
<span id="cb2-14"><a href="part-1.-prepare-training-data.html#cb2-14" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">unzip</span>(<span class="at">zipfile =</span> destination.file.path.zip,</span>
<span id="cb2-15"><a href="part-1.-prepare-training-data.html#cb2-15" tabindex="-1"></a>             <span class="at">exdir =</span> destination.file.path)</span>
<span id="cb2-16"><a href="part-1.-prepare-training-data.html#cb2-16" tabindex="-1"></a></span>
<span id="cb2-17"><a href="part-1.-prepare-training-data.html#cb2-17" tabindex="-1"></a><span class="co"># Examine the contents</span></span>
<span id="cb2-18"><a href="part-1.-prepare-training-data.html#cb2-18" tabindex="-1"></a>list.of.sound.files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">paste</span>(destination.file.path,</span>
<span id="cb2-19"><a href="part-1.-prepare-training-data.html#cb2-19" tabindex="-1"></a>                                        <span class="st">&quot;BorneoExampleData-master&quot;</span>, <span class="st">&quot;data&quot;</span>, <span class="at">sep =</span></span>
<span id="cb2-20"><a href="part-1.-prepare-training-data.html#cb2-20" tabindex="-1"></a>                                          <span class="st">&quot;/&quot;</span>),</span>
<span id="cb2-21"><a href="part-1.-prepare-training-data.html#cb2-21" tabindex="-1"></a>                                  <span class="at">full.names =</span> T)</span>
<span id="cb2-22"><a href="part-1.-prepare-training-data.html#cb2-22" tabindex="-1"></a>list.of.sound.files</span></code></pre></div>
<p>Use this function to read in the .RDA file and save it as an R object from <a href="https://stackoverflow.com/questions/5577221/how-can-i-load-an-object-into-a-variable-name-that-i-specify-from-an-r-data-file" class="uri">https://stackoverflow.com/questions/5577221/how-can-i-load-an-object-into-a-variable-name-that-i-specify-from-an-r-data-file</a></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="part-1.-prepare-training-data.html#cb3-1" tabindex="-1"></a>loadRData <span class="ot">&lt;-</span> <span class="cf">function</span>(fileName) {</span>
<span id="cb3-2"><a href="part-1.-prepare-training-data.html#cb3-2" tabindex="-1"></a>  <span class="co">#loads an RData file, and returns it</span></span>
<span id="cb3-3"><a href="part-1.-prepare-training-data.html#cb3-3" tabindex="-1"></a>  <span class="fu">load</span>(fileName)</span>
<span id="cb3-4"><a href="part-1.-prepare-training-data.html#cb3-4" tabindex="-1"></a>  <span class="fu">get</span>(<span class="fu">ls</span>()[<span class="fu">ls</span>() <span class="sc">!=</span> <span class="st">&quot;fileName&quot;</span>])</span>
<span id="cb3-5"><a href="part-1.-prepare-training-data.html#cb3-5" tabindex="-1"></a>}</span></code></pre></div>
<p>This function will load the entire list of r data files</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="part-1.-prepare-training-data.html#cb4-1" tabindex="-1"></a><span class="fu">library</span>(gibbonR)</span>
<span id="cb4-2"><a href="part-1.-prepare-training-data.html#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="part-1.-prepare-training-data.html#cb4-3" tabindex="-1"></a><span class="co"># You also need to tell R where to save the unzipped files</span></span>
<span id="cb4-4"><a href="part-1.-prepare-training-data.html#cb4-4" tabindex="-1"></a>destination.file.path <span class="ot">&lt;-</span> <span class="st">&quot;data/&quot;</span></span>
<span id="cb4-5"><a href="part-1.-prepare-training-data.html#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="part-1.-prepare-training-data.html#cb4-6" tabindex="-1"></a><span class="co"># Examine the contents</span></span>
<span id="cb4-7"><a href="part-1.-prepare-training-data.html#cb4-7" tabindex="-1"></a>list.of.sound.files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">paste</span>(destination.file.path,</span>
<span id="cb4-8"><a href="part-1.-prepare-training-data.html#cb4-8" tabindex="-1"></a>                                        <span class="st">&quot;BorneoExampleData-master&quot;</span>, <span class="st">&quot;data&quot;</span>, <span class="at">sep =</span></span>
<span id="cb4-9"><a href="part-1.-prepare-training-data.html#cb4-9" tabindex="-1"></a>                                          <span class="st">&quot;/&quot;</span>),</span>
<span id="cb4-10"><a href="part-1.-prepare-training-data.html#cb4-10" tabindex="-1"></a>                                  <span class="at">full.names =</span> T)</span>
<span id="cb4-11"><a href="part-1.-prepare-training-data.html#cb4-11" tabindex="-1"></a>list.of.sound.files</span></code></pre></div>
<pre><code>## [1] &quot;data//BorneoExampleData-master/data/multi.class.training.rda&quot;            
## [2] &quot;data//BorneoExampleData-master/data/S11_20180219_060002_1800sto3600s.rda&quot;</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="part-1.-prepare-training-data.html#cb6-1" tabindex="-1"></a>list.rda.files <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb6-2"><a href="part-1.-prepare-training-data.html#cb6-2" tabindex="-1"></a><span class="cf">for</span>(x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(list.of.sound.files)){</span>
<span id="cb6-3"><a href="part-1.-prepare-training-data.html#cb6-3" tabindex="-1"></a>  list.rda.files[[x]] <span class="ot">&lt;-</span>  <span class="fu">loadRData</span>(list.of.sound.files[[x]])</span>
<span id="cb6-4"><a href="part-1.-prepare-training-data.html#cb6-4" tabindex="-1"></a>}</span></code></pre></div>
<p>Assign each rda an informative name</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="part-1.-prepare-training-data.html#cb7-1" tabindex="-1"></a>multi.class.list <span class="ot">&lt;-</span> list.rda.files[[<span class="dv">1</span>]]</span>
<span id="cb7-2"><a href="part-1.-prepare-training-data.html#cb7-2" tabindex="-1"></a>S11_20180219_060002_1800sto3600s <span class="ot">&lt;-</span> list.rda.files[[<span class="dv">2</span>]]</span></code></pre></div>
<p>Now we create a directory with the training .wav files</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="part-1.-prepare-training-data.html#cb8-1" tabindex="-1"></a>TrainingDataDirectory <span class="ot">&lt;-</span> <span class="st">&quot;data/BorneoMultiClass/&quot;</span></span>
<span id="cb8-2"><a href="part-1.-prepare-training-data.html#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="part-1.-prepare-training-data.html#cb8-3" tabindex="-1"></a><span class="co"># Create if doesn&#39;t already exist</span></span>
<span id="cb8-4"><a href="part-1.-prepare-training-data.html#cb8-4" tabindex="-1"></a><span class="fu">dir.create</span>(TrainingDataDirectory,<span class="at">recursive =</span> T)</span>
<span id="cb8-5"><a href="part-1.-prepare-training-data.html#cb8-5" tabindex="-1"></a></span>
<span id="cb8-6"><a href="part-1.-prepare-training-data.html#cb8-6" tabindex="-1"></a><span class="cf">for</span>(a <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(multi.class.list)){</span>
<span id="cb8-7"><a href="part-1.-prepare-training-data.html#cb8-7" tabindex="-1"></a>  Temp.element <span class="ot">&lt;-</span> multi.class.list[[a]]</span>
<span id="cb8-8"><a href="part-1.-prepare-training-data.html#cb8-8" tabindex="-1"></a>  <span class="fu">writeWave</span>(Temp.element[[<span class="dv">2</span>]], <span class="fu">paste</span>(TrainingDataDirectory,Temp.element[[<span class="dv">1</span>]],<span class="at">sep=</span><span class="st">&#39;/&#39;</span>))</span>
<span id="cb8-9"><a href="part-1.-prepare-training-data.html#cb8-9" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="part-1a.-training-data-with-labeled-.wav-clips" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Part 1A. Training Data with Labeled .wav clips<a href="part-1.-prepare-training-data.html#part-1a.-training-data-with-labeled-.wav-clips" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="read-in-clips-and-calculate-mfccs" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Read in clips and calculate MFCCs<a href="part-1.-prepare-training-data.html#read-in-clips-and-calculate-mfccs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="part-1.-prepare-training-data.html#cb9-1" tabindex="-1"></a>TrainingDataDirectory <span class="ot">&lt;-</span> <span class="st">&quot;data/BorneoMultiClass/&quot;</span></span>
<span id="cb9-2"><a href="part-1.-prepare-training-data.html#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="part-1.-prepare-training-data.html#cb9-3" tabindex="-1"></a>trainingdata <span class="ot">&lt;-</span> gibbonR<span class="sc">::</span><span class="fu">MFCCFunction</span>(<span class="at">input.dir=</span>TrainingDataDirectory, <span class="at">min.freq =</span> <span class="dv">400</span>, <span class="at">max.freq =</span> <span class="dv">1600</span>,<span class="at">win.avg=</span><span class="st">&quot;standard&quot;</span>)</span>
<span id="cb9-4"><a href="part-1.-prepare-training-data.html#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="part-1.-prepare-training-data.html#cb9-5" tabindex="-1"></a><span class="co"># Convert to a factor</span></span>
<span id="cb9-6"><a href="part-1.-prepare-training-data.html#cb9-6" tabindex="-1"></a>trainingdata<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(trainingdata<span class="sc">$</span>class)</span>
<span id="cb9-7"><a href="part-1.-prepare-training-data.html#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="part-1.-prepare-training-data.html#cb9-8" tabindex="-1"></a><span class="co"># Output a table to see sample size</span></span>
<span id="cb9-9"><a href="part-1.-prepare-training-data.html#cb9-9" tabindex="-1"></a><span class="fu">table</span>(trainingdata<span class="sc">$</span>class)</span></code></pre></div>
</div>
<div id="compare-random-forest-and-support-vector-machine-for-supervised-classification" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Compare Random Forest and Support Vector Machine for Supervised Classification<a href="part-1.-prepare-training-data.html#compare-random-forest-and-support-vector-machine-for-supervised-classification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Note that this approach separates the data into two splits: training and test.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="part-1.-prepare-training-data.html#cb10-1" tabindex="-1"></a><span class="co"># Set seed for reproducilibility</span></span>
<span id="cb10-2"><a href="part-1.-prepare-training-data.html#cb10-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3</span>)</span>
<span id="cb10-3"><a href="part-1.-prepare-training-data.html#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="part-1.-prepare-training-data.html#cb10-4" tabindex="-1"></a><span class="co"># Create an index to randomly sample 25 observations for test data</span></span>
<span id="cb10-5"><a href="part-1.-prepare-training-data.html#cb10-5" tabindex="-1"></a>testindex <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">75</span>,<span class="dv">25</span>,<span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb10-6"><a href="part-1.-prepare-training-data.html#cb10-6" tabindex="-1"></a></span>
<span id="cb10-7"><a href="part-1.-prepare-training-data.html#cb10-7" tabindex="-1"></a><span class="co"># Isolate test data samples</span></span>
<span id="cb10-8"><a href="part-1.-prepare-training-data.html#cb10-8" tabindex="-1"></a>testdata <span class="ot">&lt;-</span> trainingdata[testindex,]</span>
<span id="cb10-9"><a href="part-1.-prepare-training-data.html#cb10-9" tabindex="-1"></a></span>
<span id="cb10-10"><a href="part-1.-prepare-training-data.html#cb10-10" tabindex="-1"></a><span class="co"># Remove from training data</span></span>
<span id="cb10-11"><a href="part-1.-prepare-training-data.html#cb10-11" tabindex="-1"></a>trainingdata_sub <span class="ot">&lt;-</span> trainingdata[<span class="sc">-</span>testindex,]</span>
<span id="cb10-12"><a href="part-1.-prepare-training-data.html#cb10-12" tabindex="-1"></a></span>
<span id="cb10-13"><a href="part-1.-prepare-training-data.html#cb10-13" tabindex="-1"></a><span class="co"># Ensure class is a factor</span></span>
<span id="cb10-14"><a href="part-1.-prepare-training-data.html#cb10-14" tabindex="-1"></a>trainingdata_sub<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(trainingdata_sub<span class="sc">$</span>class)</span>
<span id="cb10-15"><a href="part-1.-prepare-training-data.html#cb10-15" tabindex="-1"></a></span>
<span id="cb10-16"><a href="part-1.-prepare-training-data.html#cb10-16" tabindex="-1"></a><span class="co"># Run SVM</span></span>
<span id="cb10-17"><a href="part-1.-prepare-training-data.html#cb10-17" tabindex="-1"></a>ml.model.svm <span class="ot">&lt;-</span> e1071<span class="sc">::</span><span class="fu">svm</span>(trainingdata_sub[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(trainingdata_sub)], trainingdata_sub<span class="sc">$</span>class, <span class="at">kernel =</span> <span class="st">&quot;radial&quot;</span>, </span>
<span id="cb10-18"><a href="part-1.-prepare-training-data.html#cb10-18" tabindex="-1"></a>                           <span class="at">cross =</span> <span class="dv">25</span>,</span>
<span id="cb10-19"><a href="part-1.-prepare-training-data.html#cb10-19" tabindex="-1"></a>                           <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-20"><a href="part-1.-prepare-training-data.html#cb10-20" tabindex="-1"></a></span>
<span id="cb10-21"><a href="part-1.-prepare-training-data.html#cb10-21" tabindex="-1"></a><span class="co"># Predict SVM on test data</span></span>
<span id="cb10-22"><a href="part-1.-prepare-training-data.html#cb10-22" tabindex="-1"></a>svm.predict.labels <span class="ot">&lt;-</span> <span class="fu">predict</span>(ml.model.svm,testdata[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>)])</span>
<span id="cb10-23"><a href="part-1.-prepare-training-data.html#cb10-23" tabindex="-1"></a></span>
<span id="cb10-24"><a href="part-1.-prepare-training-data.html#cb10-24" tabindex="-1"></a><span class="co"># Create a confusion matrix</span></span>
<span id="cb10-25"><a href="part-1.-prepare-training-data.html#cb10-25" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(svm.predict.labels,testdata<span class="sc">$</span>class)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##                Reference
## Prediction      female.gibbon leaf.monkey noise solo.gibbon
##   female.gibbon             7           0     0           0
##   leaf.monkey               0           1     0           0
##   noise                     1           1     8           0
##   solo.gibbon               0           0     0           7
## 
## Overall Statistics
##                                           
##                Accuracy : 0.92            
##                  95% CI : (0.7397, 0.9902)
##     No Information Rate : 0.32            
##     P-Value [Acc &gt; NIR] : 5.992e-10       
##                                           
##                   Kappa : 0.8858          
##                                           
##  Mcnemar&#39;s Test P-Value : NA              
## 
## Statistics by Class:
## 
##                      Class: female.gibbon Class: leaf.monkey Class: noise
## Sensitivity                        0.8750             0.5000       1.0000
## Specificity                        1.0000             1.0000       0.8824
## Pos Pred Value                     1.0000             1.0000       0.8000
## Neg Pred Value                     0.9444             0.9583       1.0000
## Prevalence                         0.3200             0.0800       0.3200
## Detection Rate                     0.2800             0.0400       0.3200
## Detection Prevalence               0.2800             0.0400       0.4000
## Balanced Accuracy                  0.9375             0.7500       0.9412
##                      Class: solo.gibbon
## Sensitivity                        1.00
## Specificity                        1.00
## Pos Pred Value                     1.00
## Neg Pred Value                     1.00
## Prevalence                         0.28
## Detection Rate                     0.28
## Detection Prevalence               0.28
## Balanced Accuracy                  1.00</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="part-1.-prepare-training-data.html#cb12-1" tabindex="-1"></a><span class="co"># Run Random Forest</span></span>
<span id="cb12-2"><a href="part-1.-prepare-training-data.html#cb12-2" tabindex="-1"></a>ml.model.rf <span class="ot">&lt;-</span> randomForest<span class="sc">::</span><span class="fu">randomForest</span>(<span class="at">x=</span>trainingdata_sub[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(trainingdata_sub)], <span class="at">y =</span> trainingdata_sub<span class="sc">$</span>class)</span>
<span id="cb12-3"><a href="part-1.-prepare-training-data.html#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="part-1.-prepare-training-data.html#cb12-4" tabindex="-1"></a><span class="co"># Predict RF on test data</span></span>
<span id="cb12-5"><a href="part-1.-prepare-training-data.html#cb12-5" tabindex="-1"></a>rf.predict.labels <span class="ot">&lt;-</span> <span class="fu">predict</span>(ml.model.rf,testdata[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>)])</span>
<span id="cb12-6"><a href="part-1.-prepare-training-data.html#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="part-1.-prepare-training-data.html#cb12-7" tabindex="-1"></a><span class="co"># Create a confusion matrix</span></span>
<span id="cb12-8"><a href="part-1.-prepare-training-data.html#cb12-8" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(rf.predict.labels,testdata<span class="sc">$</span>class)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##                Reference
## Prediction      female.gibbon leaf.monkey noise solo.gibbon
##   female.gibbon             7           0     0           0
##   leaf.monkey               0           1     0           1
##   noise                     1           1     8           1
##   solo.gibbon               0           0     0           5
## 
## Overall Statistics
##                                           
##                Accuracy : 0.84            
##                  95% CI : (0.6392, 0.9546)
##     No Information Rate : 0.32            
##     P-Value [Acc &gt; NIR] : 1.197e-07       
##                                           
##                   Kappa : 0.7738          
##                                           
##  Mcnemar&#39;s Test P-Value : NA              
## 
## Statistics by Class:
## 
##                      Class: female.gibbon Class: leaf.monkey Class: noise
## Sensitivity                        0.8750             0.5000       1.0000
## Specificity                        1.0000             0.9565       0.8235
## Pos Pred Value                     1.0000             0.5000       0.7273
## Neg Pred Value                     0.9444             0.9565       1.0000
## Prevalence                         0.3200             0.0800       0.3200
## Detection Rate                     0.2800             0.0400       0.3200
## Detection Prevalence               0.2800             0.0800       0.4400
## Balanced Accuracy                  0.9375             0.7283       0.9118
##                      Class: solo.gibbon
## Sensitivity                      0.7143
## Specificity                      1.0000
## Pos Pred Value                   1.0000
## Neg Pred Value                   0.9000
## Prevalence                       0.2800
## Detection Rate                   0.2000
## Detection Prevalence             0.2000
## Balanced Accuracy                0.8571</code></pre>
</div>
</div>
<div id="part-1b.-training-data-with-raven-selection-tables" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Part 1B. Training Data with Raven Selection Tables<a href="part-1.-prepare-training-data.html#part-1b.-training-data-with-raven-selection-tables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="prepare-training-data-from-labeled-annotations" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Prepare training data from labeled annotations<a href="part-1.-prepare-training-data.html#prepare-training-data-from-labeled-annotations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The script below points to a Raven selection table and a correspond .wav file, and uses the selection table to cut out the shorter clips based on the annotation.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="part-1.-prepare-training-data.html#cb14-1" tabindex="-1"></a><span class="co"># Specify the folder where the training data will be saved</span></span>
<span id="cb14-2"><a href="part-1.-prepare-training-data.html#cb14-2" tabindex="-1"></a>TrainingDataFolderLocation <span class="ot">&lt;-</span> <span class="fu">paste</span>(FolderPath,<span class="st">&quot;/TrainingDataFromRavenSelectionTables/&quot;</span>,</span>
<span id="cb14-3"><a href="part-1.-prepare-training-data.html#cb14-3" tabindex="-1"></a>                                    <span class="at">sep=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb14-4"><a href="part-1.-prepare-training-data.html#cb14-4" tabindex="-1"></a></span>
<span id="cb14-5"><a href="part-1.-prepare-training-data.html#cb14-5" tabindex="-1"></a><span class="co"># Directory with annotated selection tables</span></span>
<span id="cb14-6"><a href="part-1.-prepare-training-data.html#cb14-6" tabindex="-1"></a>AnnotatedSelectionTables <span class="ot">&lt;-</span> <span class="fu">list.files</span>( <span class="fu">paste</span>(FolderPath,<span class="st">&quot;SelectionTables/GibbonTrainingSelectionTables/&quot;</span>,<span class="at">sep=</span><span class="st">&#39;&#39;</span>),</span>
<span id="cb14-7"><a href="part-1.-prepare-training-data.html#cb14-7" tabindex="-1"></a>                                       <span class="at">full.names =</span> T)</span>
<span id="cb14-8"><a href="part-1.-prepare-training-data.html#cb14-8" tabindex="-1"></a></span>
<span id="cb14-9"><a href="part-1.-prepare-training-data.html#cb14-9" tabindex="-1"></a><span class="co"># Directory with corresponding .wav files</span></span>
<span id="cb14-10"><a href="part-1.-prepare-training-data.html#cb14-10" tabindex="-1"></a>AnnotatedWaveFiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">paste</span>(FolderPath,<span class="st">&quot;GibbonTrainingFiles/&quot;</span>,<span class="at">sep=</span><span class="st">&#39;&#39;</span>),</span>
<span id="cb14-11"><a href="part-1.-prepare-training-data.html#cb14-11" tabindex="-1"></a>                                 <span class="at">full.names =</span> T)</span>
<span id="cb14-12"><a href="part-1.-prepare-training-data.html#cb14-12" tabindex="-1"></a></span>
<span id="cb14-13"><a href="part-1.-prepare-training-data.html#cb14-13" tabindex="-1"></a>AnnotatedWaveFilesShort <span class="ot">&lt;-</span> <span class="fu">basename</span>(AnnotatedWaveFiles)</span>
<span id="cb14-14"><a href="part-1.-prepare-training-data.html#cb14-14" tabindex="-1"></a></span>
<span id="cb14-15"><a href="part-1.-prepare-training-data.html#cb14-15" tabindex="-1"></a>AnnotatedWaveFilesShort <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(AnnotatedWaveFilesShort,<span class="at">pattern =</span> <span class="st">&#39;.wav&#39;</span>, <span class="at">n=</span><span class="dv">2</span>)[,<span class="dv">1</span>]</span>
<span id="cb14-16"><a href="part-1.-prepare-training-data.html#cb14-16" tabindex="-1"></a></span>
<span id="cb14-17"><a href="part-1.-prepare-training-data.html#cb14-17" tabindex="-1"></a><span class="co"># Loop to cut out the corresponding annotations into short clips</span></span>
<span id="cb14-18"><a href="part-1.-prepare-training-data.html#cb14-18" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span> <span class="fu">length</span>(AnnotatedSelectionTables)){</span>
<span id="cb14-19"><a href="part-1.-prepare-training-data.html#cb14-19" tabindex="-1"></a>  </span>
<span id="cb14-20"><a href="part-1.-prepare-training-data.html#cb14-20" tabindex="-1"></a>  <span class="co"># Read in selection table</span></span>
<span id="cb14-21"><a href="part-1.-prepare-training-data.html#cb14-21" tabindex="-1"></a>  TempSelectionTable <span class="ot">&lt;-</span> <span class="fu">read.delim2</span>(AnnotatedSelectionTables[i])</span>
<span id="cb14-22"><a href="part-1.-prepare-training-data.html#cb14-22" tabindex="-1"></a>  </span>
<span id="cb14-23"><a href="part-1.-prepare-training-data.html#cb14-23" tabindex="-1"></a>  <span class="co"># Find the corresponding soundfile</span></span>
<span id="cb14-24"><a href="part-1.-prepare-training-data.html#cb14-24" tabindex="-1"></a>  SoundFileIndex <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">str_detect</span>(AnnotatedSelectionTables[i],AnnotatedWaveFilesShort))</span>
<span id="cb14-25"><a href="part-1.-prepare-training-data.html#cb14-25" tabindex="-1"></a>  </span>
<span id="cb14-26"><a href="part-1.-prepare-training-data.html#cb14-26" tabindex="-1"></a>  TempAnnotateWave <span class="ot">&lt;-</span> <span class="fu">readWave</span>(AnnotatedWaveFiles[SoundFileIndex])</span>
<span id="cb14-27"><a href="part-1.-prepare-training-data.html#cb14-27" tabindex="-1"></a>  </span>
<span id="cb14-28"><a href="part-1.-prepare-training-data.html#cb14-28" tabindex="-1"></a>  ShortSoundClips <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(TempSelectionTable),</span>
<span id="cb14-29"><a href="part-1.-prepare-training-data.html#cb14-29" tabindex="-1"></a>                                <span class="cf">function</span>(j) <span class="fu">extractWave</span>(TempAnnotateWave,</span>
<span id="cb14-30"><a href="part-1.-prepare-training-data.html#cb14-30" tabindex="-1"></a>                                                        <span class="at">from=</span> <span class="fu">as.numeric</span>(TempSelectionTable[j,]<span class="sc">$</span>Begin.Time..s.),</span>
<span id="cb14-31"><a href="part-1.-prepare-training-data.html#cb14-31" tabindex="-1"></a>                                                        <span class="at">to=</span><span class="fu">as.numeric</span>(TempSelectionTable[j,]<span class="sc">$</span> End.Time..s.),</span>
<span id="cb14-32"><a href="part-1.-prepare-training-data.html#cb14-32" tabindex="-1"></a>                                                        <span class="at">xunit =</span> <span class="fu">c</span>(<span class="st">&quot;time&quot;</span>),<span class="at">plot=</span>F,<span class="at">output=</span><span class="st">&quot;Wave&quot;</span>))</span>
<span id="cb14-33"><a href="part-1.-prepare-training-data.html#cb14-33" tabindex="-1"></a>  <span class="co"># Write wave files to folder</span></span>
<span id="cb14-34"><a href="part-1.-prepare-training-data.html#cb14-34" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ShortSoundClips)){</span>
<span id="cb14-35"><a href="part-1.-prepare-training-data.html#cb14-35" tabindex="-1"></a>    TempClip <span class="ot">&lt;-</span> ShortSoundClips[[k]]</span>
<span id="cb14-36"><a href="part-1.-prepare-training-data.html#cb14-36" tabindex="-1"></a>    WavFileName <span class="ot">&lt;-</span> <span class="fu">paste</span>(TrainingDataFolderLocation,<span class="st">&#39;/female.gibbon_&#39;</span>, k, <span class="st">&#39;.wav&#39;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb14-37"><a href="part-1.-prepare-training-data.html#cb14-37" tabindex="-1"></a>    <span class="fu">writeWave</span>(TempClip,WavFileName,<span class="at">extensible =</span> F)</span>
<span id="cb14-38"><a href="part-1.-prepare-training-data.html#cb14-38" tabindex="-1"></a>  }</span>
<span id="cb14-39"><a href="part-1.-prepare-training-data.html#cb14-39" tabindex="-1"></a>  </span>
<span id="cb14-40"><a href="part-1.-prepare-training-data.html#cb14-40" tabindex="-1"></a>  </span>
<span id="cb14-41"><a href="part-1.-prepare-training-data.html#cb14-41" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="prepare-noise-training-data-from-files-without-target-signal" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Prepare noise training data from files without target signal<a href="part-1.-prepare-training-data.html#prepare-noise-training-data-from-files-without-target-signal" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The script below uses a band-limited energy detector to identify sounds in the frequency range of interest. The file included does not have any gibbon calls, so all sounds detected will be non-gibbon or noise.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="part-1.-prepare-training-data.html#cb15-1" tabindex="-1"></a><span class="co"># Specify the folder where the training data will be saved (same as above)</span></span>
<span id="cb15-2"><a href="part-1.-prepare-training-data.html#cb15-2" tabindex="-1"></a>TrainingDataFolderLocation <span class="ot">&lt;-</span> <span class="fu">paste</span>(FolderPath,<span class="st">&quot;/TrainingDataFromRavenSelectionTables/&quot;</span>,</span>
<span id="cb15-3"><a href="part-1.-prepare-training-data.html#cb15-3" tabindex="-1"></a>                                    <span class="at">sep=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb15-4"><a href="part-1.-prepare-training-data.html#cb15-4" tabindex="-1"></a></span>
<span id="cb15-5"><a href="part-1.-prepare-training-data.html#cb15-5" tabindex="-1"></a><span class="co"># Directory with annotated selection tables</span></span>
<span id="cb15-6"><a href="part-1.-prepare-training-data.html#cb15-6" tabindex="-1"></a>NoiseSelectionTables <span class="ot">&lt;-</span> <span class="fu">list.files</span>( <span class="fu">paste</span>(FolderPath,<span class="st">&quot;/SelectionTables/NoiseSelectionTables/&quot;</span>,<span class="at">sep=</span><span class="st">&#39;&#39;</span>),</span>
<span id="cb15-7"><a href="part-1.-prepare-training-data.html#cb15-7" tabindex="-1"></a>                                       <span class="at">full.names =</span> T)</span>
<span id="cb15-8"><a href="part-1.-prepare-training-data.html#cb15-8" tabindex="-1"></a></span>
<span id="cb15-9"><a href="part-1.-prepare-training-data.html#cb15-9" tabindex="-1"></a><span class="co"># Directory with corresponding .wav files</span></span>
<span id="cb15-10"><a href="part-1.-prepare-training-data.html#cb15-10" tabindex="-1"></a>NoiseWaveFiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">paste</span>(FolderPath,<span class="st">&quot;/NoiseFiles/&quot;</span>,<span class="at">sep=</span><span class="st">&#39;&#39;</span>),<span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-11"><a href="part-1.-prepare-training-data.html#cb15-11" tabindex="-1"></a></span>
<span id="cb15-12"><a href="part-1.-prepare-training-data.html#cb15-12" tabindex="-1"></a>NoiseWaveFilesShort <span class="ot">&lt;-</span> <span class="fu">basename</span>(NoiseWaveFiles)</span>
<span id="cb15-13"><a href="part-1.-prepare-training-data.html#cb15-13" tabindex="-1"></a></span>
<span id="cb15-14"><a href="part-1.-prepare-training-data.html#cb15-14" tabindex="-1"></a>NoiseWaveFilesShort <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(NoiseWaveFilesShort,<span class="at">pattern =</span> <span class="st">&#39;.wav&#39;</span>, <span class="at">n=</span><span class="dv">2</span>)[,<span class="dv">1</span>]</span>
<span id="cb15-15"><a href="part-1.-prepare-training-data.html#cb15-15" tabindex="-1"></a></span>
<span id="cb15-16"><a href="part-1.-prepare-training-data.html#cb15-16" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(NoiseSelectionTables)){</span>
<span id="cb15-17"><a href="part-1.-prepare-training-data.html#cb15-17" tabindex="-1"></a>  </span>
<span id="cb15-18"><a href="part-1.-prepare-training-data.html#cb15-18" tabindex="-1"></a>  <span class="co"># Find the corresponding soundfile</span></span>
<span id="cb15-19"><a href="part-1.-prepare-training-data.html#cb15-19" tabindex="-1"></a>  SoundFileIndex <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">str_detect</span>(NoiseSelectionTables[i],NoiseWaveFilesShort))</span>
<span id="cb15-20"><a href="part-1.-prepare-training-data.html#cb15-20" tabindex="-1"></a></span>
<span id="cb15-21"><a href="part-1.-prepare-training-data.html#cb15-21" tabindex="-1"></a>  <span class="fu">DetectBLED</span>(<span class="at">input=</span>NoiseWaveFiles[SoundFileIndex],</span>
<span id="cb15-22"><a href="part-1.-prepare-training-data.html#cb15-22" tabindex="-1"></a>           <span class="at">min.freq =</span> <span class="dv">400</span>, </span>
<span id="cb15-23"><a href="part-1.-prepare-training-data.html#cb15-23" tabindex="-1"></a>           <span class="at">max.freq =</span> <span class="dv">1600</span>,</span>
<span id="cb15-24"><a href="part-1.-prepare-training-data.html#cb15-24" tabindex="-1"></a>           <span class="at">noise.quantile.val=</span><span class="fl">0.3</span>,</span>
<span id="cb15-25"><a href="part-1.-prepare-training-data.html#cb15-25" tabindex="-1"></a>           <span class="at">spectrogram.window =</span><span class="dv">512</span>,</span>
<span id="cb15-26"><a href="part-1.-prepare-training-data.html#cb15-26" tabindex="-1"></a>           <span class="at">pattern.split =</span> <span class="st">&quot;.wav&quot;</span>, </span>
<span id="cb15-27"><a href="part-1.-prepare-training-data.html#cb15-27" tabindex="-1"></a>           <span class="at">min.signal.dur =</span> <span class="dv">3</span>,</span>
<span id="cb15-28"><a href="part-1.-prepare-training-data.html#cb15-28" tabindex="-1"></a>           <span class="at">max.sound.event.dur =</span> <span class="dv">12</span>, </span>
<span id="cb15-29"><a href="part-1.-prepare-training-data.html#cb15-29" tabindex="-1"></a>           <span class="at">wav.output =</span> <span class="st">&quot;TRUE&quot;</span>, </span>
<span id="cb15-30"><a href="part-1.-prepare-training-data.html#cb15-30" tabindex="-1"></a>           <span class="at">output.dir =</span> TrainingDataFolderLocation,</span>
<span id="cb15-31"><a href="part-1.-prepare-training-data.html#cb15-31" tabindex="-1"></a>           <span class="at">swift.time=</span><span class="cn">TRUE</span>,</span>
<span id="cb15-32"><a href="part-1.-prepare-training-data.html#cb15-32" tabindex="-1"></a>           <span class="at">time.start=</span><span class="dv">06</span>,</span>
<span id="cb15-33"><a href="part-1.-prepare-training-data.html#cb15-33" tabindex="-1"></a>           <span class="at">time.stop=</span><span class="dv">11</span>,</span>
<span id="cb15-34"><a href="part-1.-prepare-training-data.html#cb15-34" tabindex="-1"></a>           <span class="at">write.table.output=</span><span class="cn">TRUE</span>,</span>
<span id="cb15-35"><a href="part-1.-prepare-training-data.html#cb15-35" tabindex="-1"></a>           <span class="at">verbose=</span><span class="cn">TRUE</span>,</span>
<span id="cb15-36"><a href="part-1.-prepare-training-data.html#cb15-36" tabindex="-1"></a>           <span class="at">random.sample=</span><span class="cn">FALSE</span>)</span>
<span id="cb15-37"><a href="part-1.-prepare-training-data.html#cb15-37" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="now-read-in-clips-based-on-raven-selection-tables-and-calculate-mfccs" class="section level3 hasAnchor" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> Now read in clips based on Raven Selection tables and calculate MFCCs<a href="part-1.-prepare-training-data.html#now-read-in-clips-based-on-raven-selection-tables-and-calculate-mfccs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="part-1.-prepare-training-data.html#cb16-1" tabindex="-1"></a>TrainingDataFolderLocation <span class="ot">&lt;-</span> <span class="fu">paste</span>(FolderPath,<span class="st">&quot;/TrainingDataFromRavenSelectionTables/&quot;</span>,</span>
<span id="cb16-2"><a href="part-1.-prepare-training-data.html#cb16-2" tabindex="-1"></a>                                    <span class="at">sep=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb16-3"><a href="part-1.-prepare-training-data.html#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="part-1.-prepare-training-data.html#cb16-4" tabindex="-1"></a>trainingdata <span class="ot">&lt;-</span> gibbonR<span class="sc">::</span><span class="fu">MFCCFunction</span>(<span class="at">input.dir=</span>TrainingDataFolderLocation, <span class="at">min.freq =</span> <span class="dv">400</span>, <span class="at">max.freq =</span> <span class="dv">1600</span>,<span class="at">win.avg=</span><span class="st">&quot;standard&quot;</span>)</span>
<span id="cb16-5"><a href="part-1.-prepare-training-data.html#cb16-5" tabindex="-1"></a></span>
<span id="cb16-6"><a href="part-1.-prepare-training-data.html#cb16-6" tabindex="-1"></a></span>
<span id="cb16-7"><a href="part-1.-prepare-training-data.html#cb16-7" tabindex="-1"></a>trainingdata<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(trainingdata<span class="sc">$</span>class)</span>
<span id="cb16-8"><a href="part-1.-prepare-training-data.html#cb16-8" tabindex="-1"></a></span>
<span id="cb16-9"><a href="part-1.-prepare-training-data.html#cb16-9" tabindex="-1"></a><span class="fu">table</span>(trainingdata<span class="sc">$</span>class )</span></code></pre></div>
</div>
<div id="compare-random-forest-and-support-vector-machine-for-supervised-classification-1" class="section level3 hasAnchor" number="2.4.4">
<h3><span class="header-section-number">2.4.4</span> Compare Random Forest and Support Vector Machine for Supervised Classification<a href="part-1.-prepare-training-data.html#compare-random-forest-and-support-vector-machine-for-supervised-classification-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="part-1.-prepare-training-data.html#cb17-1" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb17-2"><a href="part-1.-prepare-training-data.html#cb17-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3</span>)</span>
<span id="cb17-3"><a href="part-1.-prepare-training-data.html#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="part-1.-prepare-training-data.html#cb17-4" tabindex="-1"></a><span class="co"># Check the structure (this is binary with only two classes)</span></span>
<span id="cb17-5"><a href="part-1.-prepare-training-data.html#cb17-5" tabindex="-1"></a><span class="fu">table</span>(trainingdata<span class="sc">$</span>class) </span></code></pre></div>
<pre><code>## 
## female.gibbon         noise 
##            26            27</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="part-1.-prepare-training-data.html#cb19-1" tabindex="-1"></a><span class="co"># Create an index to randomly sample 25 observations for test data</span></span>
<span id="cb19-2"><a href="part-1.-prepare-training-data.html#cb19-2" tabindex="-1"></a>testindex <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">53</span>,<span class="dv">25</span>,<span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-3"><a href="part-1.-prepare-training-data.html#cb19-3" tabindex="-1"></a></span>
<span id="cb19-4"><a href="part-1.-prepare-training-data.html#cb19-4" tabindex="-1"></a><span class="co"># Isolate test data samples</span></span>
<span id="cb19-5"><a href="part-1.-prepare-training-data.html#cb19-5" tabindex="-1"></a>testdata <span class="ot">&lt;-</span> trainingdata[testindex,]</span>
<span id="cb19-6"><a href="part-1.-prepare-training-data.html#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a href="part-1.-prepare-training-data.html#cb19-7" tabindex="-1"></a><span class="co"># Remove from training data</span></span>
<span id="cb19-8"><a href="part-1.-prepare-training-data.html#cb19-8" tabindex="-1"></a>trainingdata_sub <span class="ot">&lt;-</span> trainingdata[<span class="sc">-</span>testindex,]</span>
<span id="cb19-9"><a href="part-1.-prepare-training-data.html#cb19-9" tabindex="-1"></a></span>
<span id="cb19-10"><a href="part-1.-prepare-training-data.html#cb19-10" tabindex="-1"></a><span class="co"># Ensure class is a factor</span></span>
<span id="cb19-11"><a href="part-1.-prepare-training-data.html#cb19-11" tabindex="-1"></a>trainingdata_sub<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(trainingdata_sub<span class="sc">$</span>class)</span>
<span id="cb19-12"><a href="part-1.-prepare-training-data.html#cb19-12" tabindex="-1"></a></span>
<span id="cb19-13"><a href="part-1.-prepare-training-data.html#cb19-13" tabindex="-1"></a><span class="co"># Run SVM</span></span>
<span id="cb19-14"><a href="part-1.-prepare-training-data.html#cb19-14" tabindex="-1"></a>ml.model.svm <span class="ot">&lt;-</span> e1071<span class="sc">::</span><span class="fu">svm</span>(trainingdata_sub[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(trainingdata_sub)], trainingdata_sub<span class="sc">$</span>class, <span class="at">kernel =</span> <span class="st">&quot;radial&quot;</span>, </span>
<span id="cb19-15"><a href="part-1.-prepare-training-data.html#cb19-15" tabindex="-1"></a>                           <span class="at">cross =</span> <span class="dv">25</span>,</span>
<span id="cb19-16"><a href="part-1.-prepare-training-data.html#cb19-16" tabindex="-1"></a>                           <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-17"><a href="part-1.-prepare-training-data.html#cb19-17" tabindex="-1"></a></span>
<span id="cb19-18"><a href="part-1.-prepare-training-data.html#cb19-18" tabindex="-1"></a><span class="co"># Predict SVM on test data</span></span>
<span id="cb19-19"><a href="part-1.-prepare-training-data.html#cb19-19" tabindex="-1"></a>svm.predict.labels <span class="ot">&lt;-</span> <span class="fu">predict</span>(ml.model.svm,testdata[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>)])</span>
<span id="cb19-20"><a href="part-1.-prepare-training-data.html#cb19-20" tabindex="-1"></a></span>
<span id="cb19-21"><a href="part-1.-prepare-training-data.html#cb19-21" tabindex="-1"></a><span class="co"># Create a confusion matrix</span></span>
<span id="cb19-22"><a href="part-1.-prepare-training-data.html#cb19-22" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(svm.predict.labels,testdata<span class="sc">$</span>class)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##                Reference
## Prediction      female.gibbon noise
##   female.gibbon            11     0
##   noise                     0    14
##                                        
##                Accuracy : 1            
##                  95% CI : (0.8628, 1)  
##     No Information Rate : 0.56         
##     P-Value [Acc &gt; NIR] : 5.066e-07    
##                                        
##                   Kappa : 1            
##                                        
##  Mcnemar&#39;s Test P-Value : NA           
##                                        
##             Sensitivity : 1.00         
##             Specificity : 1.00         
##          Pos Pred Value : 1.00         
##          Neg Pred Value : 1.00         
##              Prevalence : 0.44         
##          Detection Rate : 0.44         
##    Detection Prevalence : 0.44         
##       Balanced Accuracy : 1.00         
##                                        
##        &#39;Positive&#39; Class : female.gibbon
## </code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="part-1.-prepare-training-data.html#cb21-1" tabindex="-1"></a><span class="co"># Run Random Forest</span></span>
<span id="cb21-2"><a href="part-1.-prepare-training-data.html#cb21-2" tabindex="-1"></a>ml.model.rf <span class="ot">&lt;-</span> randomForest<span class="sc">::</span><span class="fu">randomForest</span>(<span class="at">x=</span>trainingdata_sub[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(trainingdata_sub)], <span class="at">y =</span> trainingdata_sub<span class="sc">$</span>class)</span>
<span id="cb21-3"><a href="part-1.-prepare-training-data.html#cb21-3" tabindex="-1"></a></span>
<span id="cb21-4"><a href="part-1.-prepare-training-data.html#cb21-4" tabindex="-1"></a><span class="co"># Predict RF on test data</span></span>
<span id="cb21-5"><a href="part-1.-prepare-training-data.html#cb21-5" tabindex="-1"></a>rf.predict.labels <span class="ot">&lt;-</span> <span class="fu">predict</span>(ml.model.rf,testdata[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>)])</span>
<span id="cb21-6"><a href="part-1.-prepare-training-data.html#cb21-6" tabindex="-1"></a></span>
<span id="cb21-7"><a href="part-1.-prepare-training-data.html#cb21-7" tabindex="-1"></a><span class="co"># Create a confusion matrix</span></span>
<span id="cb21-8"><a href="part-1.-prepare-training-data.html#cb21-8" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(rf.predict.labels,testdata<span class="sc">$</span>class)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##                Reference
## Prediction      female.gibbon noise
##   female.gibbon            11     3
##   noise                     0    11
##                                           
##                Accuracy : 0.88            
##                  95% CI : (0.6878, 0.9745)
##     No Information Rate : 0.56            
##     P-Value [Acc &gt; NIR] : 0.0006695       
##                                           
##                   Kappa : 0.7634          
##                                           
##  Mcnemar&#39;s Test P-Value : 0.2482131       
##                                           
##             Sensitivity : 1.0000          
##             Specificity : 0.7857          
##          Pos Pred Value : 0.7857          
##          Neg Pred Value : 1.0000          
##              Prevalence : 0.4400          
##          Detection Rate : 0.4400          
##    Detection Prevalence : 0.5600          
##       Balanced Accuracy : 0.8929          
##                                           
##        &#39;Positive&#39; Class : female.gibbon   
## </code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="part-2.-run-the-detectorclassifier.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/01-Prepare-training-data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["gibbonR_tutorial.pdf", "gibbonR_tutorial.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
